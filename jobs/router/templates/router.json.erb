<%=
  require 'json'
  nats_machines = nil
  if_p('nats.machines') do |ips|
    nats_machines = ips.compact
  end.else do
    nats_machines = link('nats').instances.map { |instance| instance.address }
  end

  nats_port = nil
  if_p('nats.port') do |prop|
    nats_port = prop
  end.else do
    nats_port = link('nats').p("nats.port")
  end

  nats_user = nil
  if_p('nats.user') do |prop|
    nats_user = prop
  end.else do
    nats_user = link('nats').p("nats.user")
  end

  nats_password = nil
  if_p('nats.password') do |prop|
    nats_password = prop
  end.else do
    nats_password = link('nats').p("nats.password")
  end

  {
    'routing_api' => {
      'auth_disabled' => p('routing_api.auth_disabled'),
      'enabled' => p('routing_api.enabled'),
      'port' => p('routing_api.port'),
      'uri' => p('routing_api.uri'),
    },
    'uaa' => {
      'clients' => {
        'gorouter' => {
          'secret' => p('uaa.clients.gorouter.secret'),
        },
      },
      'token_endpoint' => p('uaa.token_endpoint'),
      'ssl' => {
        'port' => p('uaa.ssl.port'),
      },
    },
    'nats' => {
      'user' => nats_user,
      'password' => nats_password,
      'port' => nats_port,
      'machines' => nats_machines,
    },
    'spec' => {
      'id' => spec.id,
      'address' => spec.address,
    },
  }.to_json
%>
